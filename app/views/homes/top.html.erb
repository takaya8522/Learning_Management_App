<% if user_signed_in? && @study_records.empty? %>
  <div>
    <h2>次の学習予定</h2>
    <h4>下をクリックして、学習記録を登録してください！！！</h4>
     <%= link_to t('.create_record'), new_user_study_record_path(current_user) %>
  </div>
<% elsif user_signed_in? %>
  <div>
    <h2>次の学習予定</h2>
  </div>
  <%# ジャンルごとに表示 %>
  <% @categories.each do |category| %>
    <h4><%= category %></h4>
    <table>
      <thead>
        <tr>
          <th><%= t('.title') %></th>
          <th><%= t('.content') %></th>
          <th><%= t('.next_study') %></th>
          <th><%= t('.review_count') %></th>
          <th colspan="3"></th>
        </tr>
      </thead>
      <tbody>
        <%# 投稿を未復習順に表示 %>
        <% i = 0 %>
        <% @order_study_records.each do |order_study_record| %>
          <% break if i == 4 %>
          <%# genre_idが一致したら表示 %>
          <% if order_study_record[3] == category %>
            <% i += 1 %>
            <tr>
              <%# タイトル %>
              <td><%= order_study_record[4] %></td>
              <%# 内容 %>
              <td><%= order_study_record[5] %></td>
              <%# 学習までの残り時間を表示 %>
              <td>
                <% if ((order_study_record[2] - Time.now)/86400) < -1 %>
                  <p><%= ((order_study_record[2] - Time.now)/86400).floor.abs %>日の遅れ</p>
                <% elsif ((order_study_record[2] - Time.now)/86400) >= -1 && ((order_study_record[2] - Time.now)/86400) < 0 %>
                  <p>復習タイミングになりました！</p>
                <% elsif ((order_study_record[2] - Time.now)/86400) > 1 %>
                  <p>あと<%= ((order_study_record[2] - Time.now)/86400).floor %>日と<%= divide_hour(order_study_record[2] - Time.now) %>時間</p>
                <% elsif ((order_study_record[2] - Time.now)/86400) >= 0 %>
                  <%# ヘルパーに定義したdivideメソッドで小数点だけを返す %>
                  <p>あと<%= ((order_study_record[2] - Time.now)/86400*24).floor %>時間と<%= divide_minute(order_study_record[2] - Time.now) %>分</p>
                <% end %>
              </td>
              <%# 復習進捗 %>
              <td><%= order_study_record[1] %>回目</td>
              <td><%= link_to t('.review_page'), user_study_record_path(user_id: current_user.id, id: order_study_record[0]) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  <% end %>
  <br>
  <%= link_to t('.create_record'), new_user_study_record_path(current_user) %>
<% else %>
  <div>
    <h2>Study Support</h2>
    <h4>サイトについての説明文</h4>
  </div>
  <div>
    <%= image_tag 'logo_transparent.png', width: '30%' %>
  </div>
  <div>
    <p>忘却曲線とは？？</p>
    <%= link_to '忘却曲線について', homes_about_path %>
  </div>
  <%= render 'content' %>
<% end %>